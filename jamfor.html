<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adeala – Täckningskarta</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/style.css">
  <link rel="stylesheet" href="./assets/design.css">
  <link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
</script>
</head>

<body>

<!-- HEADER -->
<div id="header-placeholder"></div>

<!-- PAGE WRAPPER (NO BEIGE) -->
<section class="w-full bg-[#f8fafc]">
  <div class="content-wrapper mt-16 mb-24">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
      <div
  id="map"
  class="adeala-card md:col-span-3 h-[700px] bg-white">
  
</div>

<script>
const map = L.map("map", {
  zoomControl: true,
  attributionControl: false
}).setView([62.0, 15.0], 5);
let activeOverlay;

const overlays = {
  tele2: L.tileLayer(
    "https://mim.tele2.com/MIMCore/api/Tile/GetOverlay?x={x}&y={y}&z={z}&viewType=1&serviceThresholdIds=14,15,16,18,35,36,37,39,56,57,58,60,69,80,82,90,101,103,111,122,124&countryCode=SWE&currentServiceLayerNo=100",
    { opacity: 0.8 }
  ),

  telia: L.tileLayer.wms(
    "https://coverage.ddc.teliasonera.net/coverageportal_se/map/tile",
    {
      format: "image/png",
      transparent: true,
      opacity: 0.8
    }
  ),

  tre: L.tileLayer(
    "https://coverage.tre.se/MIMCore/api/Tile/GetOverlay?locale=se&countryCode=swe&z={z}&x={x}&y={y}&viewType=1&serviceThresholdIds=14,35,56,15,36,57,17,38,59,13,34,55,64,85,106,67,88,109,65,86,107&currentServiceLayerNo=100",
    { opacity: 0.8 }
  ),

  telenor: L.tileLayer.wms(
    "https://mboss.telenor.se/coverageportal/map/tile",
    {
      services: "NR3500_DATASA,NR_DATANSA,LTE_DATA",
      qualities: "1,2,3",
      serviceGroup: "mobile_broadband",
      format: "image/png",
      transparent: true,
      opacity: 0.8
    }
  )
};





L.tileLayer(
  "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
  {
    maxZoom: 18
  }
).addTo(map);
</script>


      <!-- OPERATORS -->
      <div class="md:col-span-1">
        <div class="adeala-card flex flex-col gap-4 bg-white">

          <button class="operator-btn" data-operator="telia">
            <img src="images/telia.png" class="h-10 mx-auto">
          </button>

          <button class="operator-btn" data-operator="tele2">
            <img src="images/tele2.jpg" class="h-10 mx-auto">
          </button>

          <button class="operator-btn" data-operator="telenor">
            <img src="images/telenor.jpg" class="h-10 mx-auto">
          </button>

          <button class="operator-btn" data-operator="tre">
            <img src="images/tre.jpg" class="h-10 mx-auto">
          </button>

          <button class="operator-btn" data-operator="halebop">
            <img src="images/halebop.webp" class="h-10 mx-auto">
          </button>

        </div>
      </div>

    </div>
  </div>
</section>

<!-- FOOTER -->
<div id="footer-placeholder"></div>

<script>
/* LOAD HEADER & FOOTER */
(async () => {
  const header = await fetch("partials/header.html");
  if (header.ok)
    document.getElementById("header-placeholder").innerHTML = await header.text();

  const footer = await fetch("partials/footer.html");
  if (footer.ok)
    document.getElementById("footer-placeholder").innerHTML = await footer.text();
})();

</script>

<script>
function styleSweden(op) {
  swedenLayer.setStyle({
    fillColor: op.base,
    fillOpacity: 0.75,
    color: "#1f2937",
    weight: 1.2
  });

  if (glowLayer) map.removeLayer(glowLayer);

  glowLayer = L.geoJSON(swedenLayer.toGeoJSON(), {
    style: {
      color: op.glow,
      weight: 4,
      opacity: 0.9,
      fillOpacity: 0
    }
  }).addTo(map);
}
function pointInPolygon(point, vs) {
  let x = point[1], y = point[0], inside = false;
  for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
    const xi = vs[i][1], yi = vs[i][0];
    const xj = vs[j][1], yj = vs[j][0];
    const intersect =
      yi > y !== yj > y &&
      x < ((xj - xi) * (y - yi)) / (yj - yi) + xi;
    if (intersect) inside = !inside;
  }
  return inside;
}

function generateNoise(op) {
  if (noiseLayer) map.removeLayer(noiseLayer);
  noiseLayer = L.layerGroup();

  let added = 0;
  while (added < 12000 * op.density) {
    const lat = 55 + Math.random() * 15;
    const lng = 11 + Math.random() * 13;

    if (!pointInPolygon([lat, lng], swedenPoly)) continue;

    L.circleMarker([lat, lng], {
      radius: Math.random() < 0.7 ? 0.8 : 1.6,
      fillColor: op.noise[Math.floor(Math.random() * op.noise.length)],
      fillOpacity: 0.9,
      stroke: false,
      renderer: L.canvas()
    }).addTo(noiseLayer);

    added++;
  }

  noiseLayer.addTo(map);
}


const OPERATORS = {
  telia: {
    base: "#4b3f72",
    glow: "#fde047",
    noise: ["#fde047", "#7dd3fc"],
    density: 1.0
  },
  tele2: {
    base: "#111827",
    glow: "#60a5fa",
    noise: ["#60a5fa"],
    density: 0.85
  },
  telenor: {
    base: "#1e3a8a",
    glow: "#93c5fd",
    noise: ["#93c5fd", "#38bdf8"],
    density: 0.9
  },
  tre: {
    base: "#064e3b",
    glow: "#5eead4",
    noise: ["#5eead4"],
    density: 0.75
  },
  halebop: {
    base: "#14532d",
    glow: "#86efac",
    noise: ["#86efac"],
    density: 0.7
  }
};

</script>

<script>
document.querySelectorAll(".operator-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document
      .querySelectorAll(".operator-btn")
      .forEach(b => b.classList.remove("active"));

    btn.classList.add("active");

    if (activeOverlay) map.removeLayer(activeOverlay);

    const key = btn.dataset.operator;
    if (!overlays[key]) return;

    activeOverlay = overlays[key];
    activeOverlay.addTo(map);
  });
});
</script>

</body>
</html>
